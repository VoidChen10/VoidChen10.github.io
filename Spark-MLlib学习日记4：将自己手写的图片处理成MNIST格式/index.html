<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">










<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="google-site-verification" content="pPA22JND_J2bsNmYLMOtbgTRrDDdJPW8FW54QN_tZjw">



  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/0f81ff2f.js","daovoice")
  daovoice('init', {
      app_id: "95e00cf9"
    });
  daovoice('update');
  </script>








  <meta name="baidu-site-verification" content="ImJKZq1eMD">







  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="手写的图片处理,MNIST,手写数字,spark,mllib">










<meta name="description" content="前言今天要讲的呢，是自己制作手写图片，并处理成MNIST的标准格式，输入到我们训练好的模型来做识别，看看效果怎样，一直用别人提供的东西，调调api什么的总感觉参与感少了点哈哈。 本来这一部分我是打算给加到MNIST数据集介绍和朴素贝叶斯那两期后面作为扩展阅读的，因为觉得应该是蛮简单的一件事，没想到实际做下来又花了我2天的时间。遇到了不少难点和细节处理，所以最后决定独立一篇文章算了。 今天这篇呢，会">
<meta name="keywords" content="手写的图片处理,MNIST,手写数字,spark,mllib">
<meta property="og:type" content="article">
<meta property="og:title" content="Spark-MLlib学习日记4：将自己手写的图片处理成MNIST格式">
<meta property="og:url" content="https://voidchen.cn/Spark-MLlib学习日记4：将自己手写的图片处理成MNIST格式/index.html">
<meta property="og:site_name" content="「旅の途中」">
<meta property="og:description" content="前言今天要讲的呢，是自己制作手写图片，并处理成MNIST的标准格式，输入到我们训练好的模型来做识别，看看效果怎样，一直用别人提供的东西，调调api什么的总感觉参与感少了点哈哈。 本来这一部分我是打算给加到MNIST数据集介绍和朴素贝叶斯那两期后面作为扩展阅读的，因为觉得应该是蛮简单的一件事，没想到实际做下来又花了我2天的时间。遇到了不少难点和细节处理，所以最后决定独立一篇文章算了。 今天这篇呢，会">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/76e60a7bgy1g0nbw52d29j20ri0g3dgu.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/76e60a7bgy1g0nby2q2qwj20is0cit8s.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/76e60a7bgy1g0qjfkz7tij20aj08w3yl.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/76e60a7bgy1g0qjgnk4msj20aj08wgln.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/76e60a7bgy1g0qjh5pvhpj20aj08wwej.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/76e60a7bgy1g0qku2e5gjj20pq08p3z2.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/76e60a7bgy1g0qkv3ha06j203j060gml.jpg">
<meta property="og:updated_time" content="2019-03-18T08:41:52.820Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spark-MLlib学习日记4：将自己手写的图片处理成MNIST格式">
<meta name="twitter:description" content="前言今天要讲的呢，是自己制作手写图片，并处理成MNIST的标准格式，输入到我们训练好的模型来做识别，看看效果怎样，一直用别人提供的东西，调调api什么的总感觉参与感少了点哈哈。 本来这一部分我是打算给加到MNIST数据集介绍和朴素贝叶斯那两期后面作为扩展阅读的，因为觉得应该是蛮简单的一件事，没想到实际做下来又花了我2天的时间。遇到了不少难点和细节处理，所以最后决定独立一篇文章算了。 今天这篇呢，会">
<meta name="twitter:image" content="http://ww1.sinaimg.cn/large/76e60a7bgy1g0nbw52d29j20ri0g3dgu.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://voidchen.cn/Spark-MLlib学习日记4：将自己手写的图片处理成MNIST格式/">



<script type="text/javascript" src="https://tajs.qq.com/stats?sId=66186813" charset="UTF-8"></script>
<script type="text/javascript" src="https://tajs.qq.com/stats?sId=66176152" charset="UTF-8"></script>



  <title>Spark-MLlib学习日记4：将自己手写的图片处理成MNIST格式 | 「旅の途中」</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">「旅の途中」</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://voidchen.cn/Spark-MLlib学习日记4：将自己手写的图片处理成MNIST格式/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="VoidChen10">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ww1.sinaimg.cn/large/76e60a7bgy1fzk07rbixlj20hs0hs3yr.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="「旅の途中」">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Spark-MLlib学习日记4：将自己手写的图片处理成MNIST格式</h2>
        

        <div class="post-meta">
		  

          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-28T15:53:29+08:00">
                2019-02-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Spark-MLlib学习日记/" itemprop="url" rel="index">
                    <span itemprop="name">Spark-MLlib学习日记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i> 阅读数
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>今天要讲的呢，是自己制作手写图片，并处理成MNIST的标准格式，输入到我们训练好的模型来做识别，看看效果怎样，一直用别人提供的东西，调调api什么的总感觉参与感少了点哈哈。</p>
<p>本来这一部分我是打算给加到MNIST数据集介绍和朴素贝叶斯那两期后面作为扩展阅读的，因为觉得应该是蛮简单的一件事，没想到实际做下来又花了我2天的时间。遇到了不少难点和细节处理，所以最后决定独立一篇文章算了。</p>
<p>今天这篇呢，会涉及到图像处理的一些相关概念，比如RGB转灰度，还有图像在计算机里面的存储方式；也会涉及到一些计算机二进制的处理，蛮多知识盲点的，网上资料也不齐全，所以接下来会整理一下，结合自己的理解把这个学习过程记录下来。特别注意的是，网上相关代码基本都是python的，都是调用封装好的工具类，我这会用scala来全部手动实现一遍，希望下次跟我一样的小菜鸟遇到这些问题的时候不会像我那样束手无策了哈哈哈哈哈哈哈哈<br><a id="more"></a></p>
<h1 id="制作手写图片"><a href="#制作手写图片" class="headerlink" title="制作手写图片"></a>制作手写图片</h1><p>这里为了省事，我就直接用ps新建一张28 x 28像素的图片来写数字了，不过一开始做出来的图片我拿去识别效果并不好，所以拿了训练数据输出灰度矩阵，再对比自己手写的数字输出的灰度矩阵，发现识别不准的原因主要出现在以下两个地方：</p>
<ol>
<li>手写数字要尽可能居中，且不要占满整个图片，边缘要留出部分空白</li>
<li>画笔像素过大，边缘像素有所偏差。</li>
</ol>
<p>对于上述问题，经过我多次尝试后，画笔参数调成<code>柔边</code>，<code>2像素</code>效果较好，创建过程如图：<br><img src="http://ww1.sinaimg.cn/large/76e60a7bgy1g0nbw52d29j20ri0g3dgu.jpg" alt=""></p>
<p><strong>画笔的选择：</strong></p>
<p><img src="http://ww1.sinaimg.cn/large/76e60a7bgy1g0nby2q2qwj20is0cit8s.jpg" alt=""></p>
<h1 id="图片的灰度处理"><a href="#图片的灰度处理" class="headerlink" title="图片的灰度处理"></a>图片的灰度处理</h1><p>手写出来的图片看着是黑白的，其实是RGB真彩图片，要变成我们MNIST的标准格式，还要先把24位深的图片处理成8位深的灰度图。</p>
<h2 id="几种灰度化方法"><a href="#几种灰度化方法" class="headerlink" title="几种灰度化方法"></a>几种灰度化方法</h2><ul>
<li>分量法：使用RGB三个分量中的一个作为灰度图的灰度值。</li>
<li>最值法：使用RGB三个分量中最大值或最小值作为灰度图的灰度值。</li>
<li>均值法：使用RGB三个分量的平均值作为灰度图的灰度值。</li>
<li><strong>加权法</strong>：由于人眼颜色敏感度不同，按下一定的权值对RGB三分量进行加权平均能得到较合理的灰度图像。一般情况按照：<code>Y = 0.30R + 0.59G + 0.11B</code>。</li>
</ul>
<p>从网上看到的资料来说哈，据说是加权法出来的图片效果最好。<br>实际上java有自己的灰度化办法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">grayImage</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">    File file = <span class="keyword">new</span> File(System.getProperty(<span class="string">"user.dir"</span>)+<span class="string">"/test.jpg"</span>);</span><br><span class="line">    BufferedImage image = ImageIO.read(file);</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">int</span> width = image.getWidth();  </span><br><span class="line">    <span class="keyword">int</span> height = image.getHeight();  </span><br><span class="line">      </span><br><span class="line">    BufferedImage grayImage = <span class="keyword">new</span> BufferedImage(width, height, BufferedImage.TYPE_BYTE_GRAY); </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i= <span class="number">0</span> ; i &lt; width ; i++)&#123;  </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; height; j++)&#123;  </span><br><span class="line">        <span class="keyword">int</span> rgb = image.getRGB(i, j);  </span><br><span class="line">        grayImage.setRGB(i, j, rgb);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    File newFile = <span class="keyword">new</span> File(System.getProperty(<span class="string">"user.dir"</span>)+<span class="string">"/method1.jpg"</span>);  </span><br><span class="line">    ImageIO.write(grayImage, <span class="string">"jpg"</span>, newFile);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看代码就是创建一个灰度图对象，然后把原图的RGB像素点强塞进去，输出成灰度图。出来的效果相当简陋，对于人来说看起来颜色比加权法出来的要糟糕不少，下面给出对比图片：</p>
<p><strong>原图</strong>:<br><img src="http://ww1.sinaimg.cn/large/76e60a7bgy1g0qjfkz7tij20aj08w3yl.jpg" alt=""></p>
<p><strong>Java自带的处理出来的灰度图：</strong><br><img src="http://ww1.sinaimg.cn/large/76e60a7bgy1g0qjgnk4msj20aj08wgln.jpg" alt=""></p>
<p><strong>自己实现的加权法出来的灰度图：</strong><br><img src="http://ww1.sinaimg.cn/large/76e60a7bgy1g0qjh5pvhpj20aj08wwej.jpg" alt=""></p>
<p>很明显的，加权法出来的图片肉眼看起来更清晰，因此最后我选择用scala来实现图片的灰度化</p>
<h2 id="scala中实现图片灰度化"><a href="#scala中实现图片灰度化" class="headerlink" title="scala中实现图片灰度化"></a>scala中实现图片灰度化</h2><p>说是scala实现吧，其实还是调了java的包哈哈哈，完整代码我放到了github上，顺手做了个批量读取文件夹里图片拼装成MNIST数据格式，所以分了3个class，于下列代码有点不一样，所以想要看如何实现还是去看完整代码吧：<a href="https://github.com/VoidChen10/MachineLearning/tree/master/src/main/scala/SparkMLlib/Base" target="_blank" rel="noopener">完整代码</a><br>这里一步步来，首先是读取图片文件：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> file = <span class="keyword">new</span> <span class="type">File</span>(path)</span><br><span class="line"><span class="keyword">val</span> img = mageIO.read(file)</span><br></pre></td></tr></table></figure>
<p>把图片灰度化：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  把图片转成灰度值图片</span></span><br><span class="line"><span class="comment"> *  原理其实还蛮简单的，就是按比例来取RGB三色，例如按比例3:6:1，就是R*0.3 + G*0.59 + B*0.11得出灰度值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getGrayImg</span></span>(img:<span class="type">BufferedImage</span>): <span class="type">BufferedImage</span> = &#123;</span><br><span class="line">    <span class="comment">//宽度（行）</span></span><br><span class="line">    <span class="keyword">val</span> width = img.getWidth</span><br><span class="line">    <span class="comment">//高度（列）</span></span><br><span class="line">    <span class="keyword">val</span> height = img.getHeight</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建一个灰度图对象</span></span><br><span class="line">    <span class="keyword">val</span> grayImg = <span class="keyword">new</span> <span class="type">BufferedImage</span>(width,height,img.getType)</span><br><span class="line">    <span class="comment">//按比例计算灰度值</span></span><br><span class="line">    <span class="keyword">for</span>(i &lt;- <span class="number">0</span> until width ; j &lt;- <span class="number">0</span> until height)&#123;</span><br><span class="line">      <span class="keyword">val</span> color = img.getRGB(i,j)</span><br><span class="line">      <span class="keyword">val</span> r = (color &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span></span><br><span class="line">      <span class="keyword">val</span> g = (color &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span></span><br><span class="line">      <span class="keyword">val</span> b = color &amp; <span class="number">0xff</span></span><br><span class="line">      <span class="keyword">val</span> gray =<span class="number">255</span> - (<span class="number">0.3</span> * r + <span class="number">0.59</span> * g + <span class="number">0.11</span> * b).toInt</span><br><span class="line">      <span class="keyword">val</span> newPixel = colorToRGB(<span class="number">256</span>, gray, gray, gray)</span><br><span class="line">      grayImg.setRGB(i,j,newPixel)</span><br><span class="line">    &#125;</span><br><span class="line">    grayImg</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>到这一步就已经得到了一个灰度化图片了，接下来我们只需要按照MNIST格式</p>
<h1 id="把灰度图拼装成MNIST格式"><a href="#把灰度图拼装成MNIST格式" class="headerlink" title="把灰度图拼装成MNIST格式"></a>把灰度图拼装成MNIST格式</h1><p>按照MNIST官网的格式，把一些数据信息转成byte数组拼接起来，再把灰度图的像素值以8位每个点（1byte）拼接起来就可以了，这里我直接给出代码，为了方便我还写了个批量读取文件夹内的图片，把这些图片全部转成byte数组再一一进行拼接。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> <span class="type">SparkMLlib</span>.<span class="type">Base</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.&#123;<span class="type">File</span>, <span class="type">FileInputStream</span>, <span class="type">FileOutputStream</span>&#125;</span><br><span class="line"><span class="keyword">import</span> java.nio.<span class="type">ByteBuffer</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="type">SparkMLlib</span>.<span class="type">Base</span>.<span class="type">FileUtil</span>.using</span><br><span class="line"><span class="keyword">import</span> <span class="type">SparkMLlib</span>.<span class="type">Base</span>.<span class="type">ImageUtil</span>.&#123;getGrayArray, getGrayImg&#125;</span><br><span class="line"><span class="keyword">import</span> javax.imageio.<span class="type">ImageIO</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> scala.collection.mutable.<span class="type">ArrayBuffer</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * @author voidChen</span></span><br><span class="line"><span class="comment">  * @date 2019/2/27 14:47</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">MNIST_Util</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 生成灰度图和MNIST格式文件</span></span><br><span class="line"><span class="comment">    * @param args</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> path = <span class="string">"C:\\Users\\42532\\Desktop\\own\\"</span></span><br><span class="line">    <span class="keyword">val</span> files = <span class="type">FileUtil</span>.getFileList(path,<span class="string">".jpg"</span>,<span class="string">"灰"</span>)</span><br><span class="line">    <span class="comment">//处理成（标签，灰度数组）</span></span><br><span class="line">    <span class="keyword">val</span> datas:<span class="type">Array</span>[(<span class="type">Int</span>, <span class="type">Array</span>[<span class="type">Byte</span>])] = files.map(f =&gt; (f.getName.substring(<span class="number">0</span>,<span class="number">1</span>).toInt,getGrayArray(<span class="type">ImageIO</span>.read(f))))</span><br><span class="line">    <span class="comment">//生成MNIST文件</span></span><br><span class="line">    imgToMNIST(datas)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//输出灰度图像</span></span><br><span class="line">    files.foreach(f =&gt; &#123;</span><br><span class="line">      <span class="keyword">val</span> grayImg = getGrayImg(<span class="type">ImageIO</span>.read(f))</span><br><span class="line">      <span class="keyword">val</span> newFile = <span class="keyword">new</span> <span class="type">File</span>(path+<span class="string">"灰"</span>+f.getName);</span><br><span class="line">      <span class="type">ImageIO</span>.write(grayImg, <span class="string">"jpg"</span>, newFile);</span><br><span class="line">    &#125;)</span><br><span class="line">    println(<span class="string">"图像输出完成"</span>)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 读取标签</span></span><br><span class="line"><span class="comment">    * @param labelPath</span></span><br><span class="line"><span class="comment">    * @return</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">loadLabel</span></span>(labelPath: <span class="type">String</span>):  <span class="type">Array</span>[<span class="type">Byte</span>] =&#123;</span><br><span class="line">    <span class="keyword">val</span> file = <span class="keyword">new</span> <span class="type">File</span>(labelPath)</span><br><span class="line">    <span class="keyword">val</span> in = <span class="keyword">new</span> <span class="type">FileInputStream</span>(file)</span><br><span class="line">    <span class="keyword">var</span> labelDS = <span class="keyword">new</span> <span class="type">Array</span>[<span class="type">Byte</span>](file.length.toInt)</span><br><span class="line">    using(<span class="keyword">new</span> <span class="type">FileInputStream</span>(file)) &#123; source =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      in.read(labelDS)</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//32 bit integer  0x00000801(2049) magic number (MSB first--high endian)</span></span><br><span class="line">    <span class="keyword">val</span> magicLabelNum = <span class="type">ByteBuffer</span>.wrap(labelDS.take(<span class="number">4</span>)).getInt</span><br><span class="line">    println(<span class="string">s"magicLabelNum=<span class="subst">$magicLabelNum</span>"</span>)</span><br><span class="line">    <span class="comment">//32 bit integer  60000            number of items</span></span><br><span class="line">    <span class="keyword">val</span> numOfLabelItems = <span class="type">ByteBuffer</span>.wrap(labelDS.slice(<span class="number">4</span>, <span class="number">8</span>)).getInt</span><br><span class="line">    println(<span class="string">s"numOfLabelItems=<span class="subst">$numOfLabelItems</span>"</span>)</span><br><span class="line">    <span class="comment">//删掉前面的文件描述</span></span><br><span class="line">    labelDS = labelDS.drop(<span class="number">8</span>)</span><br><span class="line">    <span class="comment">//打印测试数据</span></span><br><span class="line">    <span class="keyword">for</span> ((e, index) &lt;- labelDS.take(<span class="number">3</span>).zipWithIndex) &#123;</span><br><span class="line">      println(<span class="string">s"image<span class="subst">$index</span> is <span class="subst">$e</span>"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    labelDS</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 读取图像文件</span></span><br><span class="line"><span class="comment">    * @param imagesPath</span></span><br><span class="line"><span class="comment">    * @return</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">loadImages</span></span>(imagesPath: <span class="type">String</span>):  <span class="type">Array</span>[<span class="type">Array</span>[<span class="type">Byte</span>]] =&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> file = <span class="keyword">new</span> <span class="type">File</span>(imagesPath)</span><br><span class="line">    <span class="keyword">val</span> in = <span class="keyword">new</span> <span class="type">FileInputStream</span>(file)</span><br><span class="line">    <span class="keyword">var</span> trainingDS = <span class="keyword">new</span> <span class="type">Array</span>[<span class="type">Byte</span>](file.length.toInt)</span><br><span class="line">    using(<span class="keyword">new</span> <span class="type">FileInputStream</span>(file)) &#123; source =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      in.read(trainingDS)</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//32 bit integer  0x00000803(2051) magic number</span></span><br><span class="line">    <span class="keyword">val</span> magicNum = <span class="type">ByteBuffer</span>.wrap(trainingDS.take(<span class="number">4</span>)).getInt</span><br><span class="line">    println(<span class="string">s"magicNum=<span class="subst">$magicNum</span>"</span>)</span><br><span class="line">    <span class="comment">//32 bit integer  60000            number of items</span></span><br><span class="line">    <span class="keyword">val</span> numOfItems = <span class="type">ByteBuffer</span>.wrap(trainingDS.slice(<span class="number">4</span>, <span class="number">8</span>)).getInt</span><br><span class="line">    println(<span class="string">s"numOfItems=<span class="subst">$numOfItems</span>"</span>)</span><br><span class="line">    <span class="comment">//32 bit integer  28               number of rows</span></span><br><span class="line">    <span class="keyword">val</span> numOfRows = <span class="type">ByteBuffer</span>.wrap(trainingDS.slice(<span class="number">8</span>, <span class="number">12</span>)).getInt</span><br><span class="line">    println(<span class="string">s"numOfRows=<span class="subst">$numOfRows</span>"</span>)</span><br><span class="line">    <span class="comment">//32 bit integer  28               number of columns</span></span><br><span class="line">    <span class="keyword">val</span> numOfCols = <span class="type">ByteBuffer</span>.wrap(trainingDS.slice(<span class="number">12</span>, <span class="number">16</span>)).getInt</span><br><span class="line">    println(<span class="string">s"numOfCols=<span class="subst">$numOfCols</span>"</span>)</span><br><span class="line"></span><br><span class="line">    trainingDS = trainingDS.drop(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> itemsBuffer = <span class="keyword">new</span> <span class="type">ArrayBuffer</span>[<span class="type">Array</span>[<span class="type">Byte</span>]]</span><br><span class="line">    <span class="keyword">for</span>(i &lt;- <span class="number">0</span> until numOfItems)&#123;</span><br><span class="line">      itemsBuffer += trainingDS.slice( i * numOfCols * numOfRows , (i+<span class="number">1</span>) * numOfCols * numOfRows)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    itemsBuffer.toArray</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 转换成MNIST数据</span></span><br><span class="line"><span class="comment">    * @param grayArray</span></span><br><span class="line"><span class="comment">    * @return</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">imgToMNIST</span></span>(data: <span class="type">Array</span>[(<span class="type">Int</span>, <span class="type">Array</span>[<span class="type">Byte</span>])])&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//组装MNIST格式的图像文件头</span></span><br><span class="line">    <span class="keyword">var</span> images = <span class="type">ArrayBuffer</span>[<span class="type">Byte</span>]()</span><br><span class="line">    images ++= intToByteArray(<span class="number">2051</span>)  <span class="comment">//magicNum</span></span><br><span class="line">    images ++= intToByteArray(data.length)  <span class="comment">//number of items</span></span><br><span class="line">    images ++= intToByteArray(<span class="number">28</span>)  <span class="comment">//number of rows</span></span><br><span class="line">    images ++= intToByteArray(<span class="number">28</span>)  <span class="comment">//number of columns</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//组装MNIST格式的标签文件头</span></span><br><span class="line">    <span class="keyword">var</span> labels = <span class="type">ArrayBuffer</span>[<span class="type">Byte</span>]()</span><br><span class="line">    labels ++= intToByteArray(<span class="number">2049</span>)  <span class="comment">//magicNum</span></span><br><span class="line">    labels ++= intToByteArray(data.length)  <span class="comment">//number of items</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//组装数据</span></span><br><span class="line">    data.foreach(d =&gt;&#123;</span><br><span class="line">      <span class="keyword">val</span> label = (d._1 &amp; <span class="number">0xFF</span>).toByte</span><br><span class="line">      <span class="keyword">val</span> image = d._2</span><br><span class="line">      labels += label</span><br><span class="line">      images ++= image</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    var i =  0</span></span><br><span class="line">    <span class="comment">//    images.drop(16).toArray.foreach(</span></span><br><span class="line">    <span class="comment">//      b =&gt;&#123;</span></span><br><span class="line">    <span class="comment">//        print(b+" ")</span></span><br><span class="line">    <span class="comment">//        i = i+1</span></span><br><span class="line">    <span class="comment">//        if(i == 28)&#123;</span></span><br><span class="line">    <span class="comment">//          i = 0</span></span><br><span class="line">    <span class="comment">//          println()</span></span><br><span class="line">    <span class="comment">//        &#125;&#125;</span></span><br><span class="line">    <span class="comment">//    )</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//输出二进制文件</span></span><br><span class="line">    <span class="keyword">val</span> imagesFile = <span class="keyword">new</span> <span class="type">File</span>(<span class="string">"C:\\Users\\42532\\Desktop\\test-images.idx3-ubyte"</span>);</span><br><span class="line">    <span class="keyword">val</span> labelsFile = <span class="keyword">new</span> <span class="type">File</span>(<span class="string">"C:\\Users\\42532\\Desktop\\test-labels.idx1-ubyte"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> imagesWriter = <span class="keyword">new</span> <span class="type">FileOutputStream</span>(imagesFile)</span><br><span class="line">    imagesWriter.write(images.toArray)</span><br><span class="line">    imagesWriter.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> labelsWriter = <span class="keyword">new</span> <span class="type">FileOutputStream</span>(labelsFile)</span><br><span class="line">    labelsWriter.write(labels.toArray)</span><br><span class="line">    labelsWriter.close()</span><br><span class="line"></span><br><span class="line">    println(<span class="string">"文件写入完成"</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * int到byte[]</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * @param i</span></span><br><span class="line"><span class="comment">    * @return</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">intToByteArray</span></span>(i: <span class="type">Int</span>): <span class="type">Array</span>[<span class="type">Byte</span>] = &#123;</span><br><span class="line">    <span class="keyword">val</span> result = <span class="keyword">new</span> <span class="type">Array</span>[<span class="type">Byte</span>](<span class="number">4</span>)</span><br><span class="line">    <span class="comment">//由高位到低位</span></span><br><span class="line">    result(<span class="number">0</span>) = ((i &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>).toByte</span><br><span class="line">    result(<span class="number">1</span>) = ((i &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>).toByte</span><br><span class="line">    result(<span class="number">2</span>) = ((i &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>).toByte</span><br><span class="line">    result(<span class="number">3</span>) = (i &amp; <span class="number">0xFF</span>).toByte</span><br><span class="line">    result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>生成的图片和文件如下：<br><img src="http://ww1.sinaimg.cn/large/76e60a7bgy1g0qku2e5gjj20pq08p3z2.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/large/76e60a7bgy1g0qkv3ha06j203j060gml.jpg" alt=""><br>标签起名直接做成图片文件名，如果有多个“1”的图片数据呢，把文件名弄成<code>1-1.jpg</code>,<code>1-2.jpg</code>,······这样就好了</p>
<h1 id="关于图像处理的一些知识扩展"><a href="#关于图像处理的一些知识扩展" class="headerlink" title="关于图像处理的一些知识扩展"></a>关于图像处理的一些知识扩展</h1><h2 id="图像位深"><a href="#图像位深" class="headerlink" title="图像位深"></a>图像位深</h2><p>一个像素用多少位表示，这里的<code>位</code>，只是针对每一个<strong>像素点</strong>而言的。考虑到位深度平均分给R, G, B和Alpha，而只有RGB可以相互组合成颜色。所以4位颜色的图，它的位深度是4，只有2的4次幂种颜色，即16种颜色或16种灰度等级 ) 。8位颜色的图，位深度就是8，用2的8次幂表示，它含有256种颜色 ( 或256种灰度等级 )。<strong>24位颜色可称之为真彩色</strong>，位深度是24，它能组合成2的24次幂种颜色，即：16777216种颜色 ( 或称千万种颜色 )，超过了人眼能够分辨的颜色数量。当我们用24位来记录颜色时，实际上是以2^（8×3），即红、绿、蓝 ( RGB ) <a href="https://baike.baidu.com/item/%E4%B8%89%E5%9F%BA%E8%89%B2" target="_blank" rel="noopener">三基色</a>各以2的8次幂，256种颜色而存在的，三色组合就形成一千六百万种颜色。</p>
<h2 id="图像在计算机的存储格式"><a href="#图像在计算机的存储格式" class="headerlink" title="图像在计算机的存储格式"></a>图像在计算机的存储格式</h2><p>一般来说，我们自己做的图片都是24位的RGB真彩图，在上述代码中，<code>img.getRGB(i,j)</code> 这里get出来的只有一个int值，其实他已经把RGB三原色的值全放在里面了，由高位到低位排列下来，分别是<code>R</code> 8位 + <code>G</code> 8位 + <code>B</code> 8位，所以我们通过右移操作符 <code>&gt;&gt;</code> 每次移动8位，在<code>&amp; 0xFF</code> 一下，就能取出RGB分别的<code>Int</code> 颜色值来了。而最高的32位深的图片，只是在RGB的基础三多加了一个alpha透明度通道。对于32位的像素值，里面的排列顺序由高位到低位排列下来，分别是<code>alpha</code> 8位 + <code>R</code> 8位 + <code>G</code> 8位 + <code>B</code> 8位，同样可以按位把真实值取出来。</p>
<h2 id="关于-amp-0xFF-操作"><a href="#关于-amp-0xFF-操作" class="headerlink" title="关于 &amp; 0xFF 操作"></a>关于 &amp; 0xFF 操作</h2><p>回想一下大学学的计算机导论，有一条很重要但是不被当时我所重视的知识：<strong>计算机中整数以补码的形式存储</strong>。正数的补码与原码一致，这没什么问题，当时负数的补码却是原码的反码+1，这也导致了为什么我们没做<code>&amp; 0xFF</code> 操作的时候直接byte转int会由出现负数的原因之一（另一个原因是java里面int都是带了符号位，表示的数字范围在 -128 ~ 127，之间，而实际像素值是 0 ~ 255的正整数）。</p>
<p>为什么byte类型的数字要 <code>&amp;0xff</code> 再赋值给int类型呢，其本质原因就是想<strong>保持二进制补码的一致性</strong>。例如二进制的的<strong>129</strong>为<code>10000001</code> ，8位byte就能存下这个数字，当时若是直接转int，出来的结果却是<strong>-127</strong>，其原因就在于，因为当系统检测到byte可能会转化成int或者说byte与int类型进行运算的时候，就会将byte的内存空间高位补1（也就是按符号位补位）扩充到32位,变成<code>1111111111111111111111111 10000001</code>，再参与运算，这样其二进制补码其实已经不一致了。而进行与操作 <code>&amp;0xff</code> 则是这样的：<br> 1111111111111111111111111 10000001  &amp;  11111111  =   000000000000000000000000 10000001​<br>显然，这就是为什么我们在byte转成int的时候，要做一下 <code>&amp;0xff</code> 操作了</p>
<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><ul>
<li><a href="http://liuyu314.github.io/java/2014/05/24/grayscale/" target="_blank" rel="noopener">《Java实现图像灰度化》</a></li>
<li><a href="https://www.cnblogs.com/think-in-java/p/5527389.html" target="_blank" rel="noopener">《byte为什么要与上0xff？》</a></li>
<li><a href="https://medium.com/@saltedfishcaptain/%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%B8%AD%E6%95%B4%E6%95%B0%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BB%A5-%E8%A1%A5%E7%A0%81-%E7%9A%84%E5%BD%A2%E5%BC%8F%E5%AD%98%E5%82%A8-ed8f6654eb3a" target="_blank" rel="noopener">《计算机中整数为什么以【补码】的形式存储》</a></li>
</ul>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    VoidChen10
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://voidchen.cn/Spark-MLlib学习日记4：将自己手写的图片处理成MNIST格式/" title="Spark-MLlib学习日记4：将自己手写的图片处理成MNIST格式">https://voidchen.cn/Spark-MLlib学习日记4：将自己手写的图片处理成MNIST格式/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://voidchen10.github.io/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/MachineLeaning/" rel="tag"># MachineLeaning</a>
          
            <a href="/tags/数据集/" rel="tag"># 数据集</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/Spark-MLlib学习日记3：使用朴素贝叶斯识别手写图片/" rel="next" title="Spark-MLlib学习日记3：使用朴素贝叶斯识别手写数字图片">
                <i class="fa fa-chevron-left"></i> Spark-MLlib学习日记3：使用朴素贝叶斯识别手写数字图片
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/Spark-MLlib学习日记5：决策树与信息熵/" rel="prev" title="Spark-MLlib学习日记5：决策树与信息熵">
                Spark-MLlib学习日记5：决策树与信息熵 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC80MjM3OS8xODkyNg=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="http://ww1.sinaimg.cn/large/76e60a7bgy1fzk07rbixlj20hs0hs3yr.jpg" alt="VoidChen10">
            
              <p class="site-author-name" itemprop="name">VoidChen10</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/VoidChen10" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=425325925&website=www.oicqzone.com" target="_blank" title="QQ">
                      
                        <i class="fa fa-fw fa-qq"></i>QQ</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://weibo.com/u/1994787451" target="_blank" title="微博">
                      
                        <i class="fa fa-fw fa-weibo"></i>微博</a>
                  </span>
                
            </div>
          

          
          

          
          

          
        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#制作手写图片"><span class="nav-number">2.</span> <span class="nav-text">制作手写图片</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#图片的灰度处理"><span class="nav-number">3.</span> <span class="nav-text">图片的灰度处理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#几种灰度化方法"><span class="nav-number">3.1.</span> <span class="nav-text">几种灰度化方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#scala中实现图片灰度化"><span class="nav-number">3.2.</span> <span class="nav-text">scala中实现图片灰度化</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#把灰度图拼装成MNIST格式"><span class="nav-number">4.</span> <span class="nav-text">把灰度图拼装成MNIST格式</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#关于图像处理的一些知识扩展"><span class="nav-number">5.</span> <span class="nav-text">关于图像处理的一些知识扩展</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#图像位深"><span class="nav-number">5.1.</span> <span class="nav-text">图像位深</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#图像在计算机的存储格式"><span class="nav-number">5.2.</span> <span class="nav-text">图像在计算机的存储格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#关于-amp-0xFF-操作"><span class="nav-number">5.3.</span> <span class="nav-text">关于 &amp; 0xFF 操作</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考链接"><span class="nav-number">6.</span> <span class="nav-text">参考链接</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">VoidChen10</span>

  
</div>









        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 访客数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> 总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
